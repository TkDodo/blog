---
import Layout from "@layouts/layout.astro";
import Seo from "@components/seo.astro";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import SkipNavContent from "@components/a11y/skip-nav-content.astro";
import { sortAsc } from "@utils";
import Link from "@components/link.astro";
import Spacer from "@components/spacer.astro";
import PostCard from "@components/post-card.astro";
import { SITE } from "@constants";
import profileImage from "@assets/profile.jpg";
import wallpaperImage from "@assets/wallpaper.jpg";
import reactBricksImage from "@assets/sponsors/reactbricks.svg";
import workflowGenImage from "@assets/sponsors/workflowgen.png";
import monoLisaImage from "@assets/sponsors/monolisa.jpeg";
import type { ImageMetadata } from "astro";

const POSTS_TO_SHOW = 6;

const posts = sortAsc(await getCollection("blog")).slice(0, POSTS_TO_SHOW);
const banners = import.meta.glob(
  "/content/posts/**/*.{jpg,jpeg,png,webp,avif,gif,svg}",
  { eager: true, import: "default" },
) as Record<string, ImageMetadata>;

const getBanner = (entry: (typeof posts)[number]) => {
  if (!entry.data.banner || !entry.filePath) {
    return null;
  }

  const bannerPath = entry.data.banner.replace(/^\.?\//, "");
  const basePath = entry.filePath.replace(/\/index\.mdx$/, "/");
  const key = `/${basePath}${bannerPath}`;
  return banners[key] ?? null;
};

const featuredPosts = posts.map((entry) => ({
  entry,
  banner: getBanner(entry),
}));

type PremiumSponsor = {
  name: string;
  label: string;
  url: string;
  image: string | ImageMetadata;
};

const premiumSponsors: PremiumSponsor[] = [
  {
    name: "Tanner Linsley",
    label: "üíç Tanner Linsley",
    url: "https://tanstack.com/",
    image: "https://avatars.githubusercontent.com/u/5580297?s=64",
  },
  {
    name: "Workleap",
    label: "üíé Workleap",
    url: "https://www.workleap.com",
    image: "https://avatars.githubusercontent.com/u/53535748?s=64",
  },
  {
    name: "wevm",
    label: "ü•á wevm",
    url: "https://wevm.dev/",
    image: "https://avatars.githubusercontent.com/u/109633172?s=64",
  },
  {
    name: "React Bricks",
    label: "ü•â React Bricks",
    url: "https://reactbricks.com/",
    image: reactBricksImage,
  },
  {
    name: "WorkflowGen",
    label: "ü•≥ WorkflowGen",
    url: "https://www.workflowgen.com/",
    image: workflowGenImage,
  },
  {
    name: "Jonas Daniels",
    label: "ü•≥ Jonas Daniels",
    url: "https://github.com/jnsdls",
    image: "https://avatars.githubusercontent.com/u/8204858?s=64",
  },
  {
    name: "MonoLisa",
    label: "ü•≥ MonoLisa",
    url: "https://www.monolisa.dev/?ref=dominik",
    image: monoLisaImage,
  },
  {
    name: "Nadav Lebovitch",
    label: "ü•≥ Nadav Lebovitch",
    url: "https://github.com/nadavl",
    image: "https://avatars.githubusercontent.com/u/5332234?s=64",
  },
  {
    name: "Jeremy Brown",
    label: "ü•≥ Jeremy Brown",
    url: "https://github.com/jlbmagic",
    image: "https://avatars.githubusercontent.com/u/20194907?s=64",
  },
  {
    name: "deliver.media",
    label: "ü•≥ deliver.media",
    url: "https://deliver.media/",
    image: "https://avatars.githubusercontent.com/u/120005519?s=64",
  },
];
---

<Layout>
  <Seo slot="seo" />
  <SkipNavContent>
    <h1 class="sr-only">{SITE.title}</h1>
    <section
      class="relative isolate overflow-hidden rounded-2xl border border-border bg-[var(--color-ic-bg)] p-5 md:p-8"
    >
      <div aria-hidden="true" class="pointer-events-none absolute inset-0">
        <Image
          src={wallpaperImage}
          alt="TkDodo on stage at the React Advanced Conference 2024"
          class="h-full w-full object-cover opacity-40 dark:opacity-20"
          loading="eager"
          fetchpriority="high"
          decoding="sync"
        />
        <div class="absolute inset-0 bg-bg/60 dark:bg-bg/84"></div>
      </div>
      <div
        class="relative grid grid-cols-1 items-start gap-6 md:grid-cols-[minmax(0,1fr)_19rem] md:gap-8"
      >
        <div>
          <div class="flex items-start justify-between gap-3">
            <div>
              <p
                class="text-sm font-medium tracking-[0.08em] uppercase text-subtle"
              >
                TkDodo&apos;s Blog
              </p>
              <h2
                class="mt-2 text-3xl leading-tight text-highlight md:text-4xl"
              >
                üëã I&apos;m Dominik
              </h2>
            </div>
            <div class="shrink-0 md:hidden">
              <Image
                src={profileImage}
                alt="Portrait of Dominik (TkDodo)"
                class="h-14 w-14 rounded-full object-cover ring-1 ring-border"
                loading="eager"
              />
            </div>
          </div>
          <p class="mt-4 text-base leading-relaxed md:text-lg">
            üõ†Ô∏è I build things for the web, work at{" "}
            <a
              class="text-primary hover:underline"
              href="https://sentry.io"
              target="_blank"
              rel="noreferrer noopener"
            >
              Sentry</a
            >, and help maintain{" "}
            <a
              class="text-primary hover:underline"
              href="https://github.com/TanStack/query"
              target="_blank"
              rel="noreferrer noopener"
            >
              TanStack Query
            </a>{" "}and{" "}
            <a
              class="text-primary hover:underline"
              href="https://github.com/TanStack/router"
              target="_blank"
              rel="noreferrer noopener"
            >
              TanStack Router
            </a>
            . I spend a lot of my time thinking about React, TypeScript, and how to
            make frontend code simpler and more reliable.
          </p>
          <p class="mt-4 hidden text-base leading-relaxed md:text-lg lg:block">
            üíñ I love open source. Not just the code, but the people. A big part
            of my time goes into answering questions and discussing problems
            with the community.
          </p>
        </div>
        <div class="mx-auto hidden w-full max-w-[17rem] md:block md:max-w-none">
          <Image
            src={profileImage}
            alt="Portrait of Dominik (TkDodo)"
            class="aspect-square w-full rounded-3xl object-cover ring-1 ring-border"
            loading="eager"
          />
        </div>
      </div>
      <p class="relative mt-4 text-base leading-relaxed md:text-lg lg:hidden">
        üíñ I love open source. Not just the code, but the people. A big part of
        my time goes into answering questions and discussing problems with the
        community.
      </p>
      <p class="relative mt-4 text-base leading-relaxed md:text-lg">
        üìù At some point I made myself a rule: if I get a question three times,
        I write the answer down. This blog is where those answers end up, along
        with ideas, deep dives, and lessons from building real-world
        applications.
      </p>
      <p class="relative mt-4 text-base leading-relaxed md:text-lg">
        üéó If something here helps you, that already makes it worth writing, but
        if you want to further support my open source work, you can{" "}
        <a
          class="text-primary hover:underline whitespace-nowrap"
          href="https://github.com/sponsors/TkDodo"
          target="_blank"
          rel="noopener noreferrer"
        >
          sponsor me on Github</a
        >.
      </p>
    </section>
    <Spacer axis="vertical" size={32} />
    <section>
      <div
        class="border-b border-border pb-4 flex justify-between items-center"
      >
        <h2 class="font-medium text-xl md:text-2xl lg:text-3xl text-highlight">
          Latest Posts
        </h2>
        <div><Link href="/all">Read all posts</Link></div>
      </div>
      <Spacer axis="vertical" size={8} />
      <div
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-5"
      >
        {
          featuredPosts.map(({ entry, banner }) => (
            <PostCard entry={entry} banner={banner} />
          ))
        }
      </div>
    </section>
    <Spacer axis="vertical" size={32} />
    <section>
      <div
        class="border-b border-border pb-4 flex justify-between items-center"
      >
        <h2 class="font-medium text-xl md:text-2xl lg:text-3xl text-highlight">
          Premium Sponsors
        </h2>
        <div><Link href="/sponsors">See all sponsors</Link></div>
      </div>
      <Spacer axis="vertical" size={8} />
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
        {
          premiumSponsors.map((sponsor) => (
            <div class="flex items-center">
              {typeof sponsor.image === "string" ? (
                <img
                  src={sponsor.image}
                  alt={sponsor.name}
                  loading="lazy"
                  class="mr-3.5 w-16 h-16 rounded-full object-cover bg-white"
                />
              ) : (
                <Image
                  src={sponsor.image}
                  width={64}
                  height={64}
                  alt={sponsor.name}
                  loading="lazy"
                  class="mr-3.5 w-16 h-16 rounded-full object-cover bg-white"
                />
              )}
              <a
                href={sponsor.url}
                target="_blank"
                rel="noopener noreferrer"
                class="text-lg md:text-lg lg:text-xl leading-normal text-primary hover:underline"
              >
                {sponsor.label}
              </a>
            </div>
          ))
        }
      </div>
    </section>
    <Spacer axis="vertical" size={32} />
  </SkipNavContent>
</Layout>
